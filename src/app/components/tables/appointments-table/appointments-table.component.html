<div class="card">
  <div class="row between">
    <h3>Appointments</h3>
    <button class="ghost" (click)="openAdd()">Add</button>
  </div>

  <div class="filters">
    <div>
      <label>From</label>
      <input type="date" [(ngModel)]="from" />
    </div>
    <div>
      <label>To</label>
      <input type="date" [(ngModel)]="to" />
    </div>
    <button (click)="fetch()">Filter</button>
  </div>

  <div *ngIf="loading">Loadingâ€¦</div>

  <table *ngIf="!loading">
    <thead>
      <tr>
        <th>ID</th>
        <th>DateTime</th>
        <th>Client</th>
        <th>Master</th>
        <th>Services</th>
        <th>Summ</th>
        <th></th>
      </tr>
    </thead>
    <tbody>
      <tr *ngFor="let r of rows">
        <td>{{ r.id }}</td>
        <td>{{ r.datatime }}</td>
        <td>{{ r.client?.firstName }} {{ r.client?.surname }} ({{ r.client?.mobile }})</td>
        <td>{{ r.master?.firstName }} {{ r.master?.surname }}</td>
        <td>
          <ng-container *ngIf="r.services?.length; else legacy">
            <span *ngFor="let s of r.services">{{ s.id }}</span>
          </ng-container>
          <ng-template #legacy>
            {{ r.service?.id || '-' }}
          </ng-template>
        </td>
        <td>{{ r.summ || '-' }}</td>
        <td class="actions">
          <button class="ghost" (click)="openEdit(r)">Edit</button>
          <button class="danger" (click)="delete(r)">Delete</button>
        </td>
      </tr>
    </tbody>
  </table>
</div>

<app-modal-form
  [title]="'Appointment'"
  [visible]="modalVisible"
  [model]="modalModel"
  [fields]="modalFields"
  (save)="save($event)"
  (cancel)="modalVisible = false"
></app-modal-form>
